## 使用vue ui创建项目

## 导入mydb.sql文件

## 安装后台的依赖项：

```
npm install
```

<img src="%E7%AC%94%E8%AE%B0.assets/image-20211206111236310.png" alt="image-20211206111236310" style="zoom:67%;" />

运行

```
node \app.js
```

## 用postman进行接口测试：

<img src="%E7%AC%94%E8%AE%B0.assets/image-20211206142424644.png" alt="image-20211206142424644" style="zoom:80%;" />

## 登录界面实现

### 编写背景和引入全局css

需要安装less-loader解析器

```
npm install less-loader@7.0.0 --save
```

### 实现头像效果

<img src="%E7%AC%94%E8%AE%B0.assets/image-20211206155844889.png" alt="image-20211206155844889" style="zoom:67%;" />

### 实现输入框效果和小图标

<img src="%E7%AC%94%E8%AE%B0.assets/image-20211206161436655.png" alt="image-20211206161436655" style="zoom:67%;" />

### 数据绑定

```html
<el-form class="login_form" :model="loginForm">
<el-form-item prop="password">
    <el-input
        v-model="loginForm.password"
        prefix-icon="iconfont icon-3702mima"
        type="password"
    ></el-input>
</el-form-item>
```

```js
export default {
  data() {
    return {
      loginForm: {
        username: "admin",
        password: "123456",
      },
    };
  },
};
```

### 数据规则验证

为表单绑定:rules=''

```
<el-form class="login_form" :model="loginForm" :rules="loginFormRules">
```

编写规则,在失去焦点时验证

```js
      // 表单的验证规则对象
      loginFormRules: {
        // 验证用户名是否合法
        username: [
          { required: true, message: '请输入用户名', trigger: 'blur' },
          { min: 3, max: 10, message: '长度在 3 到 10 个字符', trigger: 'blur' }
        ],
        // 验证密码是否合法
        password: [
          { required: true, message: '请输入登录密码', trigger: 'blur' },
          { min: 6, max: 15, message: '长度在 6 到 15 个字符', trigger: 'blur' }
        ]
      }
```

### 重置表格

给表格添加ref

```html
      <el-form
        ref="loginFormRef"
        class="login_form"
        :model="loginForm"
        :rules="loginFormRules"
      >
```

添加按钮，点击调用自带的resetFields()方法

```js
    resetLoginForm() {
      // console.log(this);
      this.$refs.loginFormRef.resetFields();
    },
```

### 登录前校验数据

```js
    login() {
      this.$refs.loginFormRef.validate((valid) => {
        console.log(valid);//返回是否数据是否合理
      });
    },
```

### 配置axios发起登录请求

install axios

main.js中引入并配置

```js
// 配置请求的根路径
axios.defaults.baseURL = 'http://127.0.0.1:8888/api/private/v1/'
// 将axios挂载到Vue原型对象上
Vue.prototype.$http = axios
```

登录请求

```js
        if (!valid) return 0;
        this.$http.post("login", this.loginForm).then(
          (value) => {
            if (value.data.meta.status !== 200)
              return console.log("登录失败！");
            console.log("登录成功！");
          },
          (reason) => {
            console.log(reason.data);
          }
        );
```

### 登录弹窗

element.js按需导入message,将其挂载在原型对象上

```js
Vue.prototype.$message = Message
```

```js
if (value.data.meta.status !== 200)
    return this.$message.error("登录失败！");
this.$message.success("登录成功！");
```

### 登录成功跳转

```js
(value) => {
            if (value.data.meta.status !== 200)
              return this.$message.error("登录失败！");
            this.$message.success("登录成功！");
            window.sessionStorage.setItem("token",value.data.data.token)
            this.$router.push("/home")
            // 1.将登录成功之后的 token，保存到客户端的 sessionStorage 中
        //   1.1项目中除了登录之外的其它api接口，必须在登录之后才能访问
        //   1.2token只应在当前网站打开期间生效，所以将 token 保存在sessionStorage 中
        // 2.通过编程式导航跳转到后台主页，路由地址是 /home
          },
```

对应的路由

```js
  {
    path:"/home",
    component:() => import('../views/Home.vue')
  }
```

### 路由守卫权限控制

在router的index.js中配置

```js
// 挂载路由导航守卫
router.beforeEach((to, from, next) => {
  // to and from are Route Object,next() must be called to resolve the hook}
  // to将要访问的路径 from代表从哪个路径跳转而来
  // next 是一个函数，表示放行 next() 放行 next('/login') 强制跳转到登录页面
  // 如果是登录页，直接放行即可
  if (to.path === '/login') return next()
  // 获取token
  const tokenStr = window.sessionStorage.getItem('token')
  if (!tokenStr) return next('/login')
  next()
})
```

### 退出功能

点击home的退出按钮

```js
  methods: {
    exit() {
      // 清空token
      window.sessionStorage.clear();
      // 跳转到登录页
      this.$router.replace("/login");
    },
  },
```

